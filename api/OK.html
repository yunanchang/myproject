<!DOCTYPE html>
<html lang="en">
<style>
  *{border-radius: 8px;
  margin: auto;
text-align: center;}

  #icon{width: 30px;}
  
  .link:hover{background-color: rgb(107, 107, 93);}
</style>
<head>
  <title>PokeAPI Example</title>
  <meta charset="utf-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.css">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="./css.css">
  </head>

<body>
  <div class="container allBtn">
    <button type="button" class="filter-button" data-type="normal">Normal</button>
    <button type="button" class="filter-button" data-type="fire">Fire</button>
    <button type="button" class="filter-button" data-type="water">Water</button>
    <button type="button" class="filter-button" data-type="electric">Electric</button>
    <button type="button" class="filter-button" data-type="grass">Grass</button>
    <button type="button" class="filter-button" data-type="ice">Ice</button>
    <button type="button" class="filter-button" data-type="fighting">Fighting</button>
    <button type="button" class="filter-button" data-type="poison">Poison</button>
    <button type="button" class="filter-button" data-type="ground">Ground</button>
    <button type="button" class="filter-button" data-type="flying">Flying</button>
    <button type="button" class="filter-button" data-type="psychic">Psychic</button>
    <button type="button" class="filter-button" data-type="bug">Bug</button>
    <button type="button" class="filter-button" data-type="rock">Rock</button>
    <button type="button" class="filter-button" data-type="ghost">Ghost</button>
    <button type="button" class="filter-button" data-type="dragon">Dragon</button>
    <button type="button" class="filter-button" data-type="dark">Dark</button>
    <button type="button" class="filter-button" data-type="steel">Steel</button>
    <button type="button" class="filter-button" data-type="fairy">Fairy</button>
    &nbsp&nbsp&nbsp&nbsp&nbsp
    <button type="button" id="resetFilters" class="btn btn-sm">Reset</button>
    <div id="currentFilter"></div>
  </div>
  <div class="container">
    <div>
      <select name="imageType" id="imageType">
        <option value="front">Front Image</option>
        <option value="back">Back Image</option>
        <option value="front_shiny">Shiny Front Image</option>
        <option value="back_shiny">Shiny Back Image</option>
        <option value="official-artwork">Official Artwork</option> <!-- Newly added option -->
         </select>
    </div>
    <table class="display" id="myTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Image</th>
          <th>Name</th>
          <td>ability</td>
          <th>Types</th>
          <th>Height( m )</th>
          <th >Weight( kg )</th>
          <th >
            <img src="../game/pokemon.png" alt="" id="icon">
            Details</th>
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.js"></script>

  <script>
    $(document).ready(function () {
      const tbody = $('tbody');
      let dataTableInitialized = false;
      let fetchCounter = 0;
      const table = $('#myTable').DataTable();
      const currentFilter = $('#currentFilter');
      const activeFilters = [];

      for (let i = 1; i <= 20; i++) {
        getPokemonInfo(i);
      }

      // 使用 jQuery 的 AJAX 请求获取 Pokémon 信息的示例
      function getPokemonInfo(pokemonId) {
        $.ajax({
          url: `https://pokeapi.co/api/v2/pokemon/${pokemonId}`,
          method: 'GET',
          success: function (pokemonData) {
          
            let types = pokemonData.types.map(type => type.type.name).join(', ');
            let ability = pokemonData['abilities'][0]['ability']['name']
            let formattedIndex = (pokemonData.id).toString().padStart(4, '0');
            // 
            // 
            // 特殊icon--------------------------------------------------------
            // let img=`<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemonData.id}.png" alt="${pokemonData.name}">`
            let spriteUrl = pokemonData.sprites.other['official-artwork'].front_default;
            let img=`<img  src="${spriteUrl}" alt="${pokemonData.name}" />`
              //  特殊icon--------------------------------------------------------
              // 
           

              //  
            // 判斷kabi-pika---------------------------------------
            // let link=`  <i class="fa-solid fa-square-up-right" style="font-size: 34px;"></i>`;
            let link=`<img src="../game/up-arrow.png" alt=""  style="width: 30px">`;
            if(pokemonData.id===143){
              link=`<img src="../game/snorlax.png" alt=""  style="width: 30px">`;
            }
            if(pokemonData.id===25){
              link=`<img src="../game/pikachu.png" alt=""  style="width: 30px">`;
            }
            if(pokemonData.id===151){
              link=`<img src="../game/mew.png" alt=""  style="width: 30px">`;
            }
            
            // 判斷kabi-pika  end---------------------------------------
            let plink=`<a href="https://tw.portal-pokemon.com/play/pokedex/${formattedIndex}" target="_blank">
                              <div class='link'>${link} </div>  </a>`
         
          
           table.row.add([
          pokemonData.id,
          img,
          pokemonData.name,
          ability,
          types,
          (pokemonData.height/10),
          (pokemonData.weight/10),
          plink
        ]).draw();
          

           
          },
          error: function (error) {
            console.error('Error fetching Pokemon data:', error);
          }
        });
      }
     // 綁定屬性按鈕的點擊事件
     $('.filter-button').click(function () {
        const type = $(this).data('type');

        // 判斷是否已經存在於篩選條件中
        if (activeFilters.includes(type)) {
          // 移除篩選條件
          const index = activeFilters.indexOf(type);
          activeFilters.splice(index, 1);
        } else {
          // 添加篩選條件
          activeFilters.push(type);
        }

        // 使用 DataTable 的 column().search 方法，只顯示完全符合指定類型的行
        const filterRegex = activeFilters.map(filter => `(?=.*\\b${filter}\\b)`).join('');
        table.column(4).search(filterRegex, true, false).draw();

        // 顯示當前篩選條件
        updateFilterText();
      });

      // 綁定 Reset 按鈕的點擊事件
      $('#resetFilters').click(function () {
        // 清空所有篩選條件
        activeFilters.length = 0;
        table.search('').columns().search('').draw();

        // 重置當前篩選條件顯示
        currentFilter.text('');
      });

      function updateFilterText() {
        // 顯示當前篩選條件
        const filterText = activeFilters.join(', ');
        currentFilter.text(`Current Filter: ${filterText}`);
      }
    });
  </script>
</body>

</html>
